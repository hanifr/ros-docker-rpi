# Gazebo-ros-docker on Raspberry Pi 4B


**âœ… Add Pi-Specific Scripts:**
```bash
# scripts/setup_pi_environment.sh
#!/bin/bash
echo "Setting up Pi environment..."
sudo apt update
sudo apt install -y docker.io docker-compose
sudo usermod -aG docker $USER
sudo systemctl enable docker
sudo systemctl start docker
sudo chmod 666 /var/run/docker.sock
```

## ðŸ”§ Complete Pi-Optimized Setup

### Directory Structure
```
gazebo-ros-pi/
â”œâ”€â”€ docker-compose.pi.yml     # âœ… Use corrected version above
â”œâ”€â”€ Dockerfile.arm64          # âœ… From previous artifacts
â”œâ”€â”€ Dockerfile.web            # âœ… From previous artifacts  
â”œâ”€â”€ Dockerfile.monitor        # âœ… From previous artifacts
â”œâ”€â”€ requirements.txt          # âœ… From previous artifacts
â””â”€â”€ ros2_ws/                  # âœ… After running convert_to_ros2.sh
â”œâ”€â”€ models/                   # Custom Gazebo models
â”‚   â”œâ”€â”€ my_robot/
â”‚   â””â”€â”€ sensors/
â”œâ”€â”€ worlds/                            # Gazebo world files
â”‚   â”œâ”€â”€ simple_world.world
â”‚   â””â”€â”€ obstacle_course.world
â”œâ”€â”€ ros2_ws/                           # ROS workspace
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ my_robot_description/      # Robot URDF models
â”‚   â”‚   â”‚   â”œâ”€â”€ urdf/
â”‚   â”‚   â”‚   â”œâ”€â”€ meshes/
â”‚   â”‚   â”‚   â””â”€â”€ config/
â”‚   â”‚   â””â”€â”€ my_robot_gazebo/           # Simulation configuration
â”‚   â”‚       â”œâ”€â”€ launch/
â”‚   â”‚       â”‚   â””â”€â”€ headless_simulation.launch  # âœ… Launch file
â”‚   â”‚       â”œâ”€â”€ worlds/
â”‚   â”‚       â””â”€â”€ config/
â”‚   â”œâ”€â”€ build/                         # Generated by ros2_make
â”‚   â””â”€â”€ install/                       # Generated by ros2_make
â”‚   â””â”€â”€ log/                           # Generated by ros2_make
â”œâ”€â”€ scripts/                           # Helper scripts
â”‚   â”œâ”€â”€ pi_setup.sh                    # Pi environment setup
â”‚   â”œâ”€â”€ run_headless_sim.sh            # Headless simulation launcher
â”‚   â”œâ”€â”€ start_web_interface.sh         # Web UI launcher
â”‚   â”œâ”€â”€ teleop.sh                      # Robot control (from Mac)
â”‚   â”œâ”€â”€ monitor_pi_resources.sh        # Created by pi_setup.sh
â”‚   â””â”€â”€ ...
â””â”€â”€ web_interface/                     # ðŸ”„ Created by start_web_interface.sh
    â”œâ”€â”€ app.py                         # Flask web application
    â”œâ”€â”€ templates/
    â”‚   â””â”€â”€ index.html                 # Web interface HTML
    â””â”€â”€ static/                        # CSS/JS files (if needed)
```

### Custom Dockerfile for ARM64
```dockerfile
# Dockerfile.arm64
FROM arm64v8/ros:noetic-robot-focal

# Install additional packages for Pi
RUN apt-get update && apt-get install -y \
    gazebo11 \
    ros-noetic-gazebo-ros-pkgs \
    ros-noetic-gazebo-ros-control \
    ros-noetic-rosbridge-server \
    ros-noetic-web-video-server \
    python3-pip \
    htop \
    && rm -rf /var/lib/apt/lists/*

# Install web dependencies
RUN pip3 install flask socketio

# Copy workspace
COPY catkin_ws /catkin_ws
WORKDIR /catkin_ws

# Build workspace
RUN /bin/bash -c "source /opt/ros/noetic/setup.bash && catkin_make"

# Setup environment
RUN echo "source /opt/ros/noetic/setup.bash" >> ~/.bashrc
RUN echo "source /catkin_ws/devel/setup.bash" >> ~/.bashrc

EXPOSE 11311 11345 9090 8080

CMD ["bash"]
```

### Pi-Optimized Docker Compose
```yaml
# docker-compose.pi.yml
version: '3.8'
services:
  gazebo-sim:
    build:
      context: .
      dockerfile: Dockerfile.arm64
    container_name: gazebo-pi
    restart: unless-stopped
    environment:
      - ROS_MASTER_URI=http://localhost:11311
      - GAZEBO_MASTER_URI=http://localhost:11345
    volumes:
      - ./catkin_ws:/catkin_ws
      - ./models:/root/.gazebo/models  
      - ./worlds:/worlds
    ports:
      - "11311:11311"  # ROS Master
      - "11345:11345"  # Gazebo Master
      - "9090:9090"    # ROSBridge WebSocket
      - "8080:8080"    # Web Interface
    deploy:
      resources:
        limits:
          memory: 3G     # Limit for Pi
        reservations:
          memory: 1G
    command: >
      bash -c "source /opt/ros/noetic/setup.bash &&
               cd /catkin_ws &&
               catkin_make &&
               source devel/setup.bash &&
               roslaunch robot_gazebo headless_simulation.launch"

  web-interface:
    build:
      context: ./web_interface
      dockerfile: Dockerfile.web
    container_name: web-ui
    ports:
      - "3000:3000"
    depends_on:
      - gazebo-sim
    environment:
      - ROS_BRIDGE_URL=ws://gazebo-sim:9090
```

### Updated Scripts

**`scripts/run_headless_sim.sh`:**
```bash
#!/bin/bash
echo "Starting headless Gazebo simulation on Pi..."

# Check Pi temperature
TEMP=$(vcgencmd measure_temp | cut -d= -f2)
echo "Pi Temperature: $TEMP"

# Start containers
docker-compose -f docker-compose.pi.yml up -d

echo "Simulation started!"
echo "Access web interface at: http://$(hostname -I | awk '{print $1}'):3000"
echo "ROS Bridge at: ws://$(hostname -I | awk '{print $1}'):9090"
```

**`scripts/monitor_pi_resources.sh`:**
```bash
#!/bin/bash
echo "=== Pi Resource Monitor ==="
while true; do
    clear
    echo "Temperature: $(vcgencmd measure_temp)"
    echo "CPU: $(top -bn1 | grep "Cpu(s)" | awk '{print $2}')"
    echo "Memory: $(free -h | awk 'NR==2{printf "%.1f%%", $3*100/$2}')"
    echo "Docker Stats:"
    docker stats --no-stream --format "table {{.Name}}\t{{.CPUPerc}}\t{{.MemUsage}}"
    sleep 2
done
```

```
What Gets Created Automatically?
âœ… Created by pi_setup.sh:

scripts/monitor_pi_resources.sh
Various system configurations
Docker configurations

âœ… Created by start_web_interface.sh:

web_interface/ directory
web_interface/app.py - Flask web application
web_interface/templates/ directory
web_interface/templates/index.html - Web interface
```

Steps
# Run Pi setup (installs Docker, ROS, etc.)
```bash
./scripts/pi_setup.sh
```
# Start web interface (creates web_interface/ directory)
```bash
./scripts/start_web_interface.sh
```

## ðŸŽ¯ Key Advantages on Pi

1. **Better for Teaching**: No GUI dependencies = more robust
2. **Web-Based Control**: Students can access from any device
3. **Resource Awareness**: Students learn optimization
4. **Realistic Deployment**: Mirrors real robotics environments
5. **Multi-Student Support**: Easier to scale


# **simple_robot.urdf**
Physical Properties:
Dimensions: 50cm x 30cm x 10cm (L x W x H)
Mass: 1.0 kg
Shape: Rectangular box
Color: Blue (rgba: 0, 0, 0.8, 1)
Inertia Values Check:
Your inertia values look mathematically correct for a box:

ixx = 0.0166 âœ… (rotation around X-axis)
iyy = 0.0416 âœ… (rotation around Y-axis)
izz = 0.0566 âœ… (rotation around Z-axis)


Web Interface: http://your-pi-ip:5000
Resource Monitor: http://your-pi-ip:8000 (if using --profile monitoring)
Gazebo: Headless mode, accessible via web interface
